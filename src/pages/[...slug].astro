---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import AppShell from "../components/app/AppShell.astro";
import Prose from "../components/app/Prose.astro";

// Fetch all listings and pages
const { slug } = Astro.params;
const { data, render } = Astro.props;

const { Content } = await render();

export async function getStaticPaths() {
  const allListings = await getCollection("directory");
  const allPages = await getCollection("front");

  // Combine listings and pages
  const combinedEntries = allListings.concat(allPages as never);

  // Return paths based on slugs
  const test = combinedEntries.map(({ data, render, slug }) => {
    let mySlug: string = slug;

    if (mySlug === "index") {
      mySlug = "/";
    }

    return {
      params: { slug: mySlug }, // Maps to `/` when slug is empty
      props: { data, render },
    };
  });

  return test;
}
---

<Layout>
  <AppShell>
    <div class="max-w-3xl xl:max-w-6xl px-5 py-10 mx-auto">
      <Prose>
        <Content />
      </Prose>
    </div>
  </AppShell>
</Layout>
